<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedidos - GastroNet</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <header>
        <h1>Pedidos</h1>
        <nav>
            <ul>
                <li><a href="index.html">Voltar para a página principal</a></li>
                <li><a href="clientes.html">Clientes</a></li>
                <li><a href="funcionarios.html">Funcionários</a></li>
                <li><a href="cardapio.html">Cardápio</a></li>
            </ul>
        </nav>
    </header>

    <section>
        <h2>Cadastrar Pedido</h2>
        <form id="cadastroPedido">
            <label for="cliente">Cliente ID:</label>
            <input type="text" id="cliente" name="cliente" required>

            <label for="itens">Itens:</label>
            <div id="itensContainer">
                <!-- Os itens serão carregados aqui via AJAX -->
            </div>

            <label for="valorTotal">Valor Total: R$ <span id="valorTotal">0.00</span></label>

            <label for="formaPag">Forma de Pagamento:</label>
            <select id="formaPag" name="formaPag" required>
                <option value="dinheiro">Dinheiro</option>
                <option value="pix">Pix</option>
                <option value="cartao">Cartão</option>
            </select>

            <button type="submit">Cadastrar Pedido</button>
        </form>

        <h2>Lista de Pedidos</h2>
        <ul id="listaPedidos">
            <!-- Lista de pedidos será carregada aqui via AJAX -->
        </ul>
    </section>

    <script>
        $(document).ready(function() {
            // Carregar os itens do cardápio
            function carregarItensCardapio() {
                $.ajax({
                    url: 'cardapio_provider.php', // Ajuste para o nome correto do seu arquivo PHP
                    method: 'GET',
                    success: function(data) {
                        data.forEach(function(item) {
                            $('#itensContainer').append(`
                                <label>
                                    <input type="checkbox" class="itemCardapio" data-preco="${item.preco}" value="${item.id}">
                                    ${item.nome} - R$ ${item.preco}
                                </label><br>
                            `);
                        });

                        // Atualizar o valor total ao selecionar/deselecionar itens
                        $('.itemCardapio').change(function() {
                            atualizarValorTotal();
                        });
                    },
                    error: function() {
                        alert("Erro ao carregar os itens do cardápio.");
                    }
                });
            }

            // Carregar pedidos ao iniciar a página
            carregarItensCardapio();

            // Atualizar o valor total
            function atualizarValorTotal() {
                let valorTotal = 0;
                $('.itemCardapio:checked').each(function() {
                    valorTotal += parseFloat($(this).data('preco'));
                });
                $('#valorTotal').text(valorTotal.toFixed(2));
            }

            // Enviar dados do formulário para cadastrar um pedido
            $('#cadastroPedido').submit(function(event) {
                event.preventDefault(); // Impede o comportamento padrão do formulário

                const cliente = $('#cliente').val();
                const itensSelecionados = [];
                $('.itemCardapio:checked').each(function() {
                    itensSelecionados.push($(this).val());
                });
                const valorTotal = $('#valorTotal').text();
                const formaPag = $('#formaPag').val();

                // Enviar dados do pedido via AJAX para o backend
                $.ajax({
                    url: 'pedido_provider.php', // Ajuste para o nome correto do seu arquivo PHP
                    method: 'POST',
                    data: { cliente, itens: itensSelecionados, valor_total: valorTotal, forma_pag: formaPag },
                    success: function() {
                        alert('Pedido cadastrado com sucesso!');
                        carregarPedidos(); // Atualiza a lista de pedidos após o cadastro
                    },
                    error: function() {
                        alert("Erro ao cadastrar pedido.");
                    }
                });
            });

            // Carregar a lista de pedidos
            function carregarPedidos() {
                $.ajax({
                    url: 'pedido_provider.php', // Ajuste para o nome correto do seu arquivo PHP
                    method: 'GET',
                    success: function(data) {
                        $('#listaPedidos').empty(); // Limpa a lista antes de adicionar
                        data.forEach(function(pedido) {
                            $('#listaPedidos').append(`
                                <li>
                                    Pedido #${pedido.num_pedido} - Cliente ${pedido.cliente}
                                    <button onclick="buscarPedido(${pedido.id})">Buscar</button>
                                    <button onclick="alterarPedido(${pedido.id})">Alterar</button>
                                </li>
                            `);
                        });
                    },
                    error: function() {
                        alert("Erro ao carregar a lista de pedidos.");
                    }
                });
            }

            // Função para buscar pedido por ID
            function buscarPedido(id) {
                $.ajax({
                    url: 'pedido_provider.php', // Ajuste para o nome correto do seu arquivo PHP
                    method: 'GET',
                    data: { id },
                    success: function(pedido) {
                        alert('Pedido encontrado: ' + pedido.num_pedido);
                    },
                    error: function() {
                        alert("Erro ao buscar pedido.");
                    }
                });
            }

            // Função para alterar pedido
            function alterarPedido(id) {
                const numPedido = prompt("Digite o novo número do pedido:");
                const cliente = prompt("Digite o novo cliente ID:");
                const itens = prompt("Digite os novos itens:");
                const valorTotal = prompt("Digite o novo valor total:");
                const formaPag = prompt("Digite a nova forma de pagamento:");

                // Envia os dados atualizados para o backend
                $.ajax({
                    url: 'pedido_provider.php', // Ajuste para o nome correto do seu arquivo PHP
                    method: 'PUT',
                    data: { id, num_pedido: numPedido, cliente: cliente, itens: itens, valor_total: valorTotal, forma_pag: formaPag },
                    success: function() {
                        alert('Pedido alterado com sucesso!');
                        carregarPedidos(); // Atualiza a lista de pedidos após a alteração
                    },
                    error: function() {
                        alert("Erro ao alterar pedido.");
                    }
                });
            }
        });
    </script>
</body>
</html>
